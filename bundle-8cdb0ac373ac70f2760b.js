!function(t){var e={};function n(o){if(e[o])return e[o].exports;var i=e[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(o,i,function(e){return t[e]}.bind(null,i));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=1)}([function(t,e,n){},function(t,e,n){"use strict";n.r(e);n(0);const o="https://foxslot-vs-posts.herokuapp.com",i=new class{constructor(t){this.baseUrl=t}getJSON(t,e,n){this.makeRequest(t,"GET",[],null,e,n)}postJSON(t,e,n,o){null!==e?this.makeRequest(t,"POST",[{name:"Content-Type",value:"application/json"}],JSON.stringify(e),n,o):this.makeRequest(t,"POST",[],null,n,o)}deleteJSON(t,e,n,o){this.makeRequest(t,"DELETE",[],null,n,o)}makeRequest(t,e,n=[],o=[],i,r){const s=new XMLHttpRequest;s.open(e,`${this.baseUrl}${t}`);for(const t of n)s.setRequestHeader(t.name,t.value);s.addEventListener("load",t=>{if(s.status>=200&&s.status<300){const t=JSON.parse(s.responseText);void 0!==i&&i(t)}else void 0!==r&&r(s.statusText)}),s.addEventListener("error",t=>{void 0!==r&&r("Unexpected error")}),s.send(o)}}(o),r=document.getElementById("root");let s=[],l=0,c=0;const u=5,a=document.createElement("form");r.appendChild(a);const d=O("div","form-row",a),p=O("div","form-group col-md-7",d),m=O("div","form-group col-md-3",d),f=O("div","form-group col-md-2",d),b=O("input","form-control my-2 mr-sm-2",p);b.placeholder="Введите ссылку",b.setAttribute("data-id","link");const v=O("select","custom-select my-2 mr-sm-2",m);v.setAttribute("data-id","type");!function(t,e){for(const n of e){const e=document.createElement("option");e.value=n,"regular"===e.value?e.textContent="Обычный":"image"===e.value?e.textContent="Изображение":"audio"===e.value?e.textContent="Аудио":"video"===e.value?e.textContent="Видео":e.textContent=n,t.appendChild(e)}}(v,["regular","image","audio","video"]),O("button","btn btn-primary my-2 mr-sm-2",f).textContent="Добавить";const y=a.querySelector("[data-id=link]"),k=a.querySelector("[data-id=type]");a.onsubmit=function(t){t.preventDefault();const e={typeContent:k.value,linkContent:y.value,id:0,content:y.value};i.postJSON("/posts",e,w,T),y.value="",k.value="regular"};const C=O("button","btn btn-primary d-block mx-auto mt-2",r);C.textContent="Загрузить новые посты",C.setAttribute("data-id","load-new-posts-button"),C.addEventListener("click",(function(){fetch(`${o}/get-new-posts/${c}`).then(t=>{if(!t.ok)throw new Error(t.statusText);return t.json()}).then(t=>{"false"!==t&&(S(t),C.classList.toggle("button-invisibility"),$())}).catch(t=>{console.log(t)})})),C.classList.toggle("button-invisibility");const x=O("ul","list-group",r),h=O("button","btn btn-primary d-block mx-auto mt-2",r);function g(){fetch(`${o}/posts/${l}/${u}`).then(t=>{if(!t.ok)throw new Error(t.statusText);return t.json()}).then(t=>{if(t.length>=u)S(t);else if(0===t.length){const t=r.querySelector("[data-id=load-more-button]");r.removeChild(t)}else{S(t);const e=r.querySelector("[data-id=load-more-button]");r.removeChild(e)}}).catch(t=>{console.log(t)})}function S(t){for(const n of t)if(-1===!q(n.id))e=n.id,fetch(`${o}/post/${e}`).then(t=>{if(!t.ok)throw new Error(t.statusText);return t.json()}).then(t=>{const e=s[q(t.id)];e.likes=t.likes;const n=x.querySelector(`[data-post-id = ${e.id}]`),o=n.querySelector("[data-id = button-like]");o.textContent="❤ "+e.likes}).catch(t=>{console.log(t)});else{const t=O("div","card my-2 mr-sm-2",x);t.setAttribute("data-post-id",`${n.id}`);let e="";if("regular"===n.typeContent){O("h5","card-text ml-3",t).textContent=n.linkContent,e="Пост с текстом"}else if("image"===n.typeContent){O("img","card-img-top",t).src=n.linkContent,e="Пост с изображением"}else if("audio"===n.typeContent){const o=O("audio","card-img-top",t);o.src=n.linkContent,o.controls=!0,e="Пост с аудио"}else if("video"===n.typeContent){const o=O("video","embed-responsive-item",t);o.src=n.linkContent,o.controls=!0,e="Пост с видео"}else{O("p","card-text",t).textContent="Спам",e="Пост со спамом"}const o=O("div","card-body",t);O("p","card-text",o).textContent=e;const r=O("button","btn btn-primary",o);r.textContent="❤ "+n.likes,r.setAttribute("data-id","button-like"),r.onclick=function(){i.postJSON(`/posts/${n.id}/likes`,null,E,T)};const l=O("button","btn btn-primary ml-2",o);l.textContent="👎",l.onclick=function(){i.deleteJSON(`/posts/${n.id}/likes`,null,E,T)},s.unshift(n)}var e;s.sort((t,e)=>e.id-t.id),l=s[s.length-1].id,c=s[0].id+1}function $(){s.sort((t,e)=>e.id-t.id),x.innerHTML="";for(const t of s){const e=O("div","card my-2 mr-sm-2",x);e.setAttribute("data-post-id",`${t.id}`);let n="";if("regular"===t.typeContent){O("h5","card-text ml-3",e).textContent=t.linkContent,n="Пост с текстом"}else if("image"===t.typeContent){O("img","card-img-top",e).src=t.linkContent,n="Пост с изображением"}else if("audio"===t.typeContent){const o=O("audio","card-img-top",e);o.src=t.linkContent,o.controls=!0,n="Пост с аудио"}else if("video"===t.typeContent){const o=O("video","embed-responsive-item",e);o.src=t.linkContent,o.controls=!0,n="Пост с видео"}else{O("p","card-text",e).textContent="Спам",n="Пост со спамом"}const o=O("div","card-body",e);O("p","card-text",o).textContent=n;const r=O("button","btn btn-primary",o);r.textContent="❤ "+t.likes,r.setAttribute("data-id","button-like"),r.onclick=function(){i.postJSON(`/posts/${t.id}/likes`,null,E,T)};const s=O("button","btn btn-primary ml-2",o);s.textContent="👎",s.onclick=function(){i.deleteJSON(`/posts/${t.id}/likes`,null,E,T)}}}function O(t,e,n){const o=document.createElement(t);return o.className=e,n.appendChild(o),o}function E(t){const e=s[q(t.id)];e.likes=t.likes,x.querySelector(`[data-post-id="${e.id}"]`).querySelector("[data-id='button-like']").textContent="❤ "+e.likes}function q(t){return s.findIndex(e=>e.id===t)}function w(t){s.unshift(t),c=s[0].id+1,$()}h.textContent="Загрузить еще",h.setAttribute("data-id","load-more-button"),h.addEventListener("click",g);const T=t=>{console.log(t)};setInterval(()=>{fetch(`${o}/new-posts/${c}`).then(t=>{if(!t.ok)throw new Error(t.statusText);return t.text()}).then(t=>{"false"!==t&&(C.classList.remove("button-invisibility"),C.textContent=`Загрузить новые посты (${t})`)}).catch(t=>{console.log(t)})},5e3),g()}]);